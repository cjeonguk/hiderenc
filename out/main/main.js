"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _electron=require("electron");var _electronUpdater=require("electron-updater");var _encrypt=require("./modules/encrypt");var _path=_interopRequireDefault(require("path"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var isDev=process.env.NODE_ENV==="development";var mainWindow;var createWindow=function(){mainWindow=new _electron.BrowserWindow({width:600,height:360,minWidth:600,minHeight:360,autoHideMenuBar:true,webPreferences:{preload:_path.default.join(__dirname,"preload.js")}});var isMac=process.platform==="darwin";if(isMac){var menuTemplate=[{label:_electron.app.name,submenu:[{role:"about"},{type:"separator"},{role:"services"},{type:"separator"},{role:"hide"},{role:"hideOthers"},{role:"unhide"},{type:"separator"},{role:"quit"},]},];_electron.Menu.setApplicationMenu(_electron.Menu.buildFromTemplate(menuTemplate))}if(isDev){mainWindow.loadURL("http://localhost:3000");mainWindow.webContents.openDevTools();console.log(process.env.NODE_ENV)}else mainWindow.loadFile(_path.default.join(__dirname,"..","renderer","index.html"))};_electron.app.whenReady().then(function(){createWindow();_electronUpdater.autoUpdater.checkForUpdatesAndNotify();_electron.app.on("activate",function(){if(_electron.BrowserWindow.getAllWindows().length===0)createWindow()})});_electron.app.on("window-all-closed",function(){if(process.platform!=="darwin")_electron.app.quit()});_electronUpdater.autoUpdater.on("update-available",function(){var options={message:"Available updates exist.",title:"Update",type:"question",buttons:["Not now","Quit the program and update"],defaultId:1};var res=_electron.dialog.showMessageBoxSync(mainWindow,options);if(res)_electronUpdater.autoUpdater.downloadUpdate()});_electronUpdater.autoUpdater.on("update-downloaded",function(){_electronUpdater.autoUpdater.quitAndInstall()});_electronUpdater.autoUpdater.on("error",function(err){_electron.dialog.showErrorBox("Error",err.toString())});_electron.ipcMain.on("open-file",function(event){var selectedFiles=_electron.dialog.showOpenDialogSync(mainWindow,{defaultPath:require("os").homedir()});event.returnValue=selectedFiles});_electron.ipcMain.on("file-opened",function(event){if(process.argv.length>=2&&!isDev){event.returnValue=true}else event.returnValue=false});_electron.ipcMain.on("get-file-path",function(event){event.returnValue=process.argv[1]});_electron.ipcMain.on("encrypt-or-decrypt",function(event,passwd,encrypt,filePaths){if(encrypt){for(var i=0;i<filePaths.length;i++){(0,_encrypt.encryptFile)(filePaths[i],passwd)}var options={type:"info",title:"Information",message:"Encryption succeed."};_electron.dialog.showMessageBox(mainWindow,options)}else{var success=true;for(var i1=0;i1<filePaths.length;i1++){success=(0,_encrypt.decryptFile)(filePaths[i1],passwd)}if(success){var options1={type:"info",title:"Information",message:"Decryption succeed."};_electron.dialog.showMessageBox(mainWindow,options1)}else _electron.dialog.showErrorBox("ERROR","Maybe this error is because the password you entered is wrong.")}})